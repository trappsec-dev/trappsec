---
layout: default
title: API Reference
nav_order: 3

permalink: /api/
---

<div class="lang-switcher">
  <button class="lang-btn active" onclick="switchLang('python')">Python</button>
  <button class="lang-btn" onclick="switchLang('node')">Node.js</button>
</div>

# API Reference

This reference documents the core classes and methods available in the trappsec SDK.

## Sentry

The main entry point for the library.

<div class="lang-content" data-lang="python" markdown="1">

### `Sentry(app, service: str, environment: str)`

</div>
<div class="lang-content" data-lang="node" markdown="1">

### `new Sentry(app, service, environment)`

</div>

Initializes the trappsec Sentry.

*   **app**: The application instance (Flask/FastAPI/Express).
*   **service**: Name of your service (e.g., "PaymentService").
*   **environment**: Deployment environment (e.g., "Production", "Staging").

## TrapBuilder

Returned by `ts.trap(path)`. Used to configure a decoy route.

### `methods`

<div class="lang-content" data-lang="python" markdown="1">

```python
trap.methods("GET", "POST")
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
trap.methods("GET", "POST");
```

</div>

Specifies the HTTP methods this trap should accept. Defaults to `["GET", "POST"]`.

### `intent`

<div class="lang-content" data-lang="python" markdown="1">

```python
trap.intent("Credential Harvesting")
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
trap.intent("Credential Harvesting");
```

</div>

Sets the intent label for alerts generated by this trap.

### `respond`

Configures the response sent to authenticated requests (or all requests if `if_unauthenticated` is not set).

**Signature**

<div class="lang-content" data-lang="python" markdown="1">

```python
trap.respond(status: int, body: dict | str | Callable, mime_type: str = None, template: str = None)
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
trap.respond({ status: number, body: object | string | Function, mime_type: string, template: string })
```

</div>

**Examples**

<div class="lang-content" data-lang="python" markdown="1">

```python
trap.respond(200, {"status": "ok"})
trap.respond(403, "Access Denied", mime_type="text/plain")
trap.respond(template="deprecated_api")
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
trap.respond({ status: 200, body: { "status": "ok" } });
trap.respond({ status: 403, body: "Access Denied", mime_type: "text/plain" });
trap.respond({ template: "deprecated_api" });
```

</div>

*   **status**: HTTP status code.
*   **body**: JSON object, string, or a function returning one of those.
*   **mime_type**: Content-Type header (defaults to "application/json"). You must explicitly set this to "text/plain" (or others) if returning a non-JSON body.
*   **template**: Name of a registered response template.

### `if_unauthenticated`

Configures a specific response for unauthenticated requests. Overrides `respond` for unauthenticated traffic.

**Signature**

<div class="lang-content" data-lang="python" markdown="1">

```python
trap.if_unauthenticated(status: int, body: dict | Callable, mime_type: str = None, template: str = None)
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
trap.if_unauthenticated({ status: number, body: object | Function, mime_type: string, template: string })
```

</div>

**Example**

<div class="lang-content" data-lang="python" markdown="1">

```python
trap.if_unauthenticated(401, {"error": "Login Required"})
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
trap.if_unauthenticated({ status: 401, body: { "error": "Login Required" } });
```

</div>

## WatchBuilder

Returned by `ts.watch(path)`. Used to configure honey fields on legitimate routes.

### `body`

Monitors the request body for specific keys.

**Signature**

<div class="lang-content" data-lang="python" markdown="1">

```python
watch.body(name: str, default: Any = NO_DEFAULT, intent: str = None)
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
watch.body(name, { defaultValue: any, intent: string })
```

</div>

**Example**

<div class="lang-content" data-lang="python" markdown="1">

```python
watch.body("is_admin", default=False, intent="PrivEsc")
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
watch.body("is_admin", { defaultValue: false, intent: "PrivEsc" });
```

</div>

*   **name**: The field name to watch.
*   **default**: (Optional) If provided, alerts only if the value differs from this default. If omitted, alerts on any presence of the key.
*   **intent**: The intent label for the alert.

## Configuration

Global configuration methods.

### `identify_user`

Registers a callback to extract user identity from the request.

<div class="lang-content" data-lang="python" markdown="1">

```python
ts.identify_user(lambda r: {"id": r.headers.get("x-user-id")})
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
ts.identify_user((req) => ({ "id": req.headers["x-user-id"] }));
```

</div>

### `override_source_ip`

Registers a callback to extract the real client IP (e.g., from `X-Forwarded-For`).

<div class="lang-content" data-lang="python" markdown="1">

```python
ts.override_source_ip(lambda r: r.remote_addr)
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
ts.override_source_ip((req) => req.ip);
```

</div>

### `add_webhook`

Adds a webhook destination for alerts.

<div class="lang-content" data-lang="python" markdown="1">

```python
ts.add_webhook("https://...")
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
ts.add_webhook("https://...");
```

</div>

### `add_otel`

Enables OpenTelemetry integration for alerts.

<div class="lang-content" data-lang="python" markdown="1">

```python
ts.add_otel()
```

</div>
<div class="lang-content" data-lang="node" markdown="1">

```javascript
ts.add_otel();
```

</div>



